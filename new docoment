import pandas as pd
import os

# ✅ Step 1: Set your parent folder path here
parent_dir = r"C:\Users\2179048\Downloads\Y21, Y22, Y23 - Sem1 to Sem6  2024 (1)"

# ✅ Step 2: Prepare list to collect data
all_data = []

# ✅ Step 3: Walk through folders and read CSVs
for folder in os.listdir(parent_dir):
    folder_path = os.path.join(parent_dir, folder)
    print(f"🔍 Checking folder: {folder_path}")
    
    if os.path.isdir(folder_path):
        for file in os.listdir(folder_path):
            if file.lower().endswith(".csv"):  # case-insensitive check
                file_path = os.path.join(folder_path, file)
                print(f"📄 Reading file: {file_path}")
                try:
                    df = pd.read_csv(file_path)
                    df['SourceFolder'] = folder  # Add source folder info
                    all_data.append(df)
                except Exception as e:
                    print(f"❌ Error reading {file_path}: {e}")

# ✅ Step 4: Combine all into one DataFrame
if all_data:
    final_df = pd.concat(all_data, ignore_index=True)
    print("✅ Merged DataFrame created successfully!")

    # ✅ Step 5: Preview top 5 rows
    display(final_df.head())

    # ✅ Step 6: Export to a new CSV (optional)
    final_df.to_csv("merged_data.csv", index=False)
    print("💾 Merged CSV saved as 'merged_data.csv'")
else:
    print("⚠️ No CSV files found to merge.")
