# Define output shape functions
def compute_output_shape_reduce_sum(input_shape):
    # Assuming reduce_sum reduces the last dimension (e.g., channel-wise summation)
    return input_shape[:-1]

# Updated `enh_img_real` and `enh_img_imag` with explicit output shapes
enh_img_real = Lambda(
    reduce_sum, 
    output_shape=compute_output_shape_reduce_sum, 
    name='enh_img_real_2'
)(mul_mask_real)

enh_img_imag = Lambda(
    reduce_sum, 
    output_shape=compute_output_shape_reduce_sum, 
    name='enh_img_imag_2'
)(mul_mask_imag)

enh_img = Lambda(atan2, name='phase_img')([enh_img_imag, enh_img_real])
